# Course Project Part 2

> CS 312 System Administration  
> Kimberly Yeo  
> [yeoki@oregonstate.edu](mailto:yeoki@oregonstate.edu)

---

## Background

### What will we do?

We will be fully automating the deployment of a Minecraft server on AWS without ever using the AWS Management Console. This includes provisioning infrastructure, configuring the server, installing dependencies, and ensuring the Minecraft server (re)starts on reboot.

### How will we do it?

* **Terraform** provisions AWS EC2 instances and security groups.
* **Ansible (in WSL)** installs Java 21, downloads the Minecraft server JAR, sets up EULA acceptance, and configures a systemd service.
* **Bash scripting** automates Terraform and Ansible terminal commands.
* **nmap** verifies that the Minecraft port (25565) is open.

---

## Requirements

To successfully run the pipeline and connect to the deployed Minecraft server, ensure the following tools and configurations are in place:

### What tools should be installed?

Install the following on your local machine:

* **Terraform** (v1.5+): Used to provision AWS resources.
* **AWS CLI** (v2+): Used to authenticate and interact with AWS programmatically.
* **WSL** (Ubuntu): Required to run Ansible in a Linux shell (for Windows OS). To install:
* **Ansible** (in WSL): Used to install Java, configure the server, and set up systemd.
* **Git Bash or VSCode Terminal**: To execute Bash scripts from Windows.
* **nmap**: To verify that port 25565 is open and accepting Minecraft connections.

Terraform and AWS CLI should be installed (for Windows OS), using:

* **Terraform**: [https://developer.hashicorp.com/terraform/downloads](https://developer.hashicorp.com/terraform/downloads)
* **AWS CLI**: [https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html)

Terminal command for installing WSL (Ubuntu):

```bash
wsl --install -d Ubuntu
```

> **Note:** You will be asked to create a default Unix user account. Provide a user name and password for later use.

> **Note:** You may be asked to restart your device to complete the installation process.

Terminal commands for installing tools inside WSL (Ubuntu):

```bash
sudo apt update && sudo apt upgrade -y
```
```bash
sudo apt install -y ansible
```
```bash
sudo apt install -y nmap
```

### AWS Credentials & CLI Setup

Use `aws configure` to set up AWS credentials:

```bash
aws configure
```

You will be prompted to enter:

* AWS Access Key ID
* AWS Secret Access Key
* Default region name (use `us-east-1`)

> **Note:** If using the AWS Academy Learner Lab, you can find your AWS CLI information under **[AWS Details]** > AWS CLI: **[Show]**.

> **Note:** If you run into an issue related to your AWS credentials, try manually copy-pasting the information into `~/.aws/credentials` on your local machine. If you still encounter issues, turn off any VPNs before trying again.

### Key File

* Save your `minecraft-key.pem` file from Part 1 inside `~/.ssh/` in WSL
* Ensure correct permissions are set using the following terminal command:

```bash
chmod 600 ~/.ssh/minecraft-key.pem
```

### Environment Configuration

* No environment variables are needed.

---

## Folder Structure

```
project_root/
├── automation/
│   ├── terraform/
│   │   ├── main.tf
│   │   ├── variables.tf
│   │   └── outputs.tf
│   └── ansible/
│       ├── playbook.yml
│       └── inventory.ini (autogenerated)
├── setup.sh
└── README.md
```

---

## Usage Instructions

### 1. Clone the Repository

```bash
git clone https://github.com/yeoki-osu/cs-312-course-project.git
```
```bash
cd cs-312-course-project
```

### 2. Run the Setup Script

```bash
chmod +x setup.sh
```
```bash
./setup.sh
```

This script:

* Provisions the EC2 instance via Terraform
* Extracts the public IP
* Runs Ansible inside WSL to install Java 21 (via Corretto tarball), configure Minecraft, and start the systemd service

> **Note:** You will be prompted for a EC2 key pair name. Enter `minecraft-key` if you followed the setup from Part 1, otherwise enter the name of your EC2 key pair.  

> **Note:** Enter `yes` into the terminal if a fingerprint prompt shows up during the WSL portion of the script.

### 3. Verify the Server is Running
```bash
wsl
```
```bash
nmap -sV -Pn -p T:25565 <public_ip>
```

> **Note:** You should see port 25565 listed as open.

---

## Connect via Minecraft

1. Open Minecraft Launcher
2. Ensure version is 1.21.5
3. Click **[Multiplayer]** > **[Direct Connect]**
4. Enter your EC2 public IP
5. Click **[Join Server]**

---

## Extra: Auto-Restart on Reboot

The `minecraft.service` unit file is configured to:

* Start on boot
* Restart on failure
* Gracefully shut down using SIGINT

To test, enter:

```bash
ssh -i ~/.ssh/minecraft-key.pem ec2-user@<public_ip>
```
```bash
sudo reboot
```

Then after reconnecting, enter:

```bash
sudo systemctl status minecraft
```

> **Note:** It should show `Active: active (running)`

---

## Resources Used

* [Amazon Corretto JDK 21 Downloads](https://docs.aws.amazon.com/corretto/latest/corretto-21-ug/downloads-list.html)
* [Minecraft Server JAR (Official Mojang Link)](https://www.minecraft.net/en-us/download/server)
* [Terraform AWS Provider Documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
* [Terraform Downloads (CLI)](https://developer.hashicorp.com/terraform/downloads)
* [Ansible Getting Started Guide](https://docs.ansible.com/ansible/latest/getting_started/index.html)
* [Terraform aws\_instance Resource](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance)
* [Terraform Output Values](https://developer.hashicorp.com/terraform/language/values/outputs)
* [AWS CLI Installation for Windows](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html)
* [AWS CLI Configuration Guide](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html)
* [WSL Installation Guide (Microsoft)](https://learn.microsoft.com/en-us/windows/wsl/install)
* [nmap Installation Guide for Ubuntu (PhoenixNAP)](https://phoenixnap.com/kb/how-to-install-nmap-ubuntu)
* [Modify File Permissions with chmod (Linode)](https://www.linode.com/docs/guides/modify-file-permissions-with-chmod/)
* [Systemd Service Unit Documentation](https://www.freedesktop.org/software/systemd/man/systemd.service.html)
